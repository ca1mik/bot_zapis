# qwesade-booking-calendar-bot

Телеграм‑бот записи с календариком на Google Sheets и синком в Google Calendar.

## Что умеет
- диалог: услуга → дата → слот → район → пожелания → подтверждение
- проверка занятости слота, без дублей
- просмотр доступности `/avail` + быстрые кнопки «Записаться {слот}»
- **календарная сетка в боте** при выборе даты (месяц с пометками занятых дней)
- команда **/agenda**: ближайшие подтверждённые записи списком
- уведомления админу с кнопками ✅/❌ (меняют статус в «Заявках»)
- (опц.) **Apps Script**: синх таблицы → Google Calendar + рендер листа «Календарь‑Месяц»

## Запуск
```bash
python -m venv .venv
source .venv/bin/activate    # Windows: .venv\Scripts\activate
pip install -r requirements.txt
cp .env.example .env         # заполни значения
python -m src.main
```

### Таблица Google
Создай таблицу с листами: **«Заявки»** и **«Календарь»**. Дай доступ (Editor) сервисному аккаунту.  
В `.env` вставь JSON ключ в `GOOGLE_CREDS_JSON` одной строкой.

#### Заголовки листов
- «Заявки»:  
  `Timestamp | RequestID | TelegramID | Username | Name | Service | DateISO | DateText | TimeSlot | District | Wishes | Status | AdminComment`
- «Календарь»:  
  Первая строка: `Date | 10:00–12:00 | 13:00–15:00 | 16:00–18:00 | 19:00–21:00` (или свои из `TIME_SLOTS`).

## Календарная сетка в боте
Файл `src/calendar_kb.py` — отрисовывает месяц (Пн–Вс).  
Занятые дни помечены точкой `•` (берётся из листа «Календарь»).

## /agenda
Команда показывает 20 ближайших подтверждённых заявок на 60 дней вперёд.

## Apps Script (опционально)
В папке `apps_script/` лежит `calendar_sync_and_render.gs`:
- функция `syncBookingsToCalendar()` — синхронит **«Подтверждённые»** заявки в календарь `Qwesade`;
- функция `renderMonthGrid()` — вписывает список событий каждого дня в сетку листа «Календарь‑Месяц».
Открой «Расширения → Apps Script», вставь код, настрой триггеры.
